kind: ConfigMap
apiVersion: v1
metadata:
  name: cm-logback
  labels:
    stand: ift
    stand.id: ift-default
data:
  logback.xml: |-
    <?xml version="1.0" encoding="UTF-8"?>
    <configuration debug="true" scan="true" scanPeriod="60 seconds">
        <property name="loggingDir" value="/tmp" />
        <property name="loggingFile" value="application.log" />
        <property name="loggingJSONFile" value="application.log.json" />
    
        <appender name="JSON" class="ch.qos.logback.core.rolling.RollingFileAppender">
            <file>${loggingDir}/${loggingJSONFile}</file>
            <encoder class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
                <providers>
                    <timestamp>
                        <fieldName>timestamp</fieldName>
                        <pattern>[UNIX_TIMESTAMP_AS_STRING]</pattern>
                    </timestamp>
                    <logLevel>
                        <fieldName>levelStr</fieldName>
                    </logLevel>
                    <logLevelValue>
                        <fieldName>levelInt</fieldName>
                    </logLevelValue>
                    <loggerName>
                        <fieldName>loggerName</fieldName>
                    </loggerName>
                    <threadName>
                        <fieldName>threadName</fieldName>
                    </threadName>
                    <callerData>
                        <classFieldName>callerClass</classFieldName>
                        <methodFieldName>callerMethod</methodFieldName>
                        <lineFieldName>callerLine</lineFieldName>
                        <fileFieldName>callerFile</fileFieldName>
                    </callerData>
                    <message/>
                    <stackTrace>
                        <fieldName>stackTrace</fieldName>
                        <throwableConverter class="net.logstash.logback.stacktrace.ShortenedThrowableConverter">
                            <maxDepthPerThrowable>30</maxDepthPerThrowable>
                            <maxLength>4096</maxLength>
                            <rootCauseFirst>true</rootCauseFirst>
                        </throwableConverter>
                    </stackTrace>
                    <nestedField>
                        <fieldName>mdc</fieldName>
                        <providers>
                            <mdc/>
                        </providers>
                    </nestedField>
                </providers>
            </encoder>
            <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
                <fileNamePattern>${loggingDir}/${loggingJSONFile}_%d{yyyy-MM-dd}_%i.zip</fileNamePattern>
                <maxFileSize>10MB</maxFileSize>
                <maxHistory>5</maxHistory>
                <totalSizeCap>50MB</totalSizeCap>
            </rollingPolicy>
        </appender>
    
        <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
            <encoder>
                <pattern>%d{ISO8601} [%t] [%level] \(%c\) [%C::%M:%L] mdc:\(%mdc\)| %m%n</pattern>
                <charset>UTF-8</charset>
            </encoder>
        </appender>
    
        <root level="info">
            <appender-ref ref="STDOUT"/>
            <appender-ref ref="JSON"/>
        </root>
    
        <logger name="sbp.logger.endpoint" level="INFO" />
        <logger name="sbp.logger.endpoint.service.ChannelConfigurationScheduledService" level="ERROR" />
    <!--<logger name="org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver" level="info" />-->
    
    </configuration>